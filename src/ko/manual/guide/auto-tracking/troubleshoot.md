---
aside: true
titleTemplate: ':title | 空荧酒馆'
prev:
  text: '【位置追踪】注意事项'
  link: '../auto-tracking/importantnotes'
next:
  text: '【地图性能占用高】前后台帧率设置'
  link: '../bg/bgfrate'
description: Troubleshoot
---

[文：位置追踪问题排查.docx]: # '以下为“问题排查”内容'

# 【位置追踪】问题排查

```card
theme: medium
title: 官方开发反馈 QQ 群
desc: 228382171（https://jq.qq.com/?_wv=1027&k=EqhYN9uI）
link: https://jq.qq.com/?_wv=1027&k=EqhYN9uI
```

English version: [\[Automatic Tracking\] Important Notes | Kongying Tavern](http://yuanshen.site/docs/en/manual/guide/auto-tracking/importantnotes)

## 简介

本功能基于【图像识别】技术实现。不是外挂，不会导致封号。

若想使用本功能，请确认：

- 您的操作版本至少是win10或以上版本（win7不支持追踪）
- 使用原神客户端，不限服务器，不支持云游戏
- 游戏内【解锁神像点亮地图】，游戏内【左上角小地图】完整。
- 游戏内【左上角小地图】中，无大面积遮挡（如黄色的任务范围圆圈）
- 可支持独占全屏，推荐使用【[无边框全屏](http://support.qq.com/products/321980/faqs/97887)】模式运行游戏。

## 基础说明

查看左侧菜单下方的“位置追踪版本”，如果显示为“未初始化”，尝试重新开启位置追踪

![192584e1056ce0916dc418c79e942977.png](https://txc.gtimg.com/data/321980/2023/0825/192584e1056ce0916dc418c79e942977.png)

将实时识别游戏内当前角色位置（小地图坐标位置）并同步显示到【地图客户端】上（像游戏内地图一样）。以便于对照地图，防止迷路。

![fd745ec564afdff997a49957a17f4080.png](https://txc.gtimg.com/data/321980/2021/0611/fd745ec564afdff997a49957a17f4080.png)

## 扩展使用

可在设置中开启【窗口置顶】，并拖动缩小地图窗口，以替代游戏内小地图

可在设置中开启【覆盖模式】，可自行设置触发快捷键，以替代游戏内大地图

## 注意事项

### 自动追踪无反应

- Win11系统可能由于使用了「窗口化游戏优化」导致追踪失败，在图形设置中开启「不使用窗口化游戏优化」（见下图）

- 如果图像设置中没有「原神」，可以将“<游戏安装目录>/Genshin Impact Game/YuanShen.exe”添加到列表中。

![7c54b7ab7d92dcf0885fddb388bde9e3.jpeg](https://txc.gtimg.com/data/321980/2023/0225/7c54b7ab7d92dcf0885fddb388bde9e3.jpeg)

- 如果自动追踪长时间没反应，或者出现原地卡死，可使用菜单中的“追踪截图”功能获取追踪截图，并选择“截图目录”查看。如果追踪截图空白，或者与当前地图不符，可能是截图模式不兼容当前系统，更换截图模式即可。

- 尝试切换追踪模式，Bitblt 和 DirectX 都试试

- 如果能正常截图，但依然出现原地卡死，请检查分辨率是否过小（不小于1280x720，建议1920x1080以上），小地图是否解锁，是否有大面积遮挡，是否有显著的特征。若调整后依旧无法追踪，请参见文末提交反馈。
- 官方的【云 · 原神】由于设置了不可捕获屏幕，所以无法追踪（可能由于防止多开脚本缘故）。

### 位置追踪坐标漂移

- 表现为箭头能跟着角色移动，没有晃动等异常情况，但坐标偏差很大（比如人在璃月港，箭头却在层岩巨渊）。
- 重启地图后，重新尝试开启位置追踪

- 退出地图，并删除安装目录的位置追踪缓存，重新启动地图并等待数分钟重建缓存

### 自动追踪晃动，速度慢

限于算法限制，晃动和延迟很难避免，一般10m以内算正常误差

目前存在的问题如下：

- 为了尽量减少晃动，输出结果进行了滤波，在移动时可能会出现轻微的惯性。
- 对于比较规则的区域（梅洛彼得堡，赤王遗迹群等）识别精度可能会大幅度下降。
- 特征点较少的区域，坐标偏移比较严重
- 因为视角扇形的遮挡，原地转动视角可能会导致追踪小箭头绕圈转

以下是减轻晃动的几个建议：

- 如果能正常截图，但时常出现乱晃的现象，请检查分辨率是否过小（不小于1280x720，建议1920x1080以上），小地图是否解锁，是否有大面积遮挡，是否有显著的特征。
- 若开启显卡滤镜、HDR等改变色彩显示的功能，则可能会影响到自动追踪的精度。
- 后台暂停会导致位置追踪也同时暂停，可能会导致切地图时，追踪延迟变高。
- 在配置允许的情况下，将追踪间隔调到0.1秒，能比较好的改善延迟高的问题。
- 如果在某一个区域，长时间没反应（超过3分钟以上），或者箭头跑到地图外面，请于文末与开发者联系反馈。

### 自动追踪崩溃：

- 自动追踪（特别是DirectX模式）有概率会崩溃，崩溃的表现包括但不限于：

- 弹出「Runtime Error」窗口或者「该内存不能为Read」
- 地图客户端突然无响应
- 地图客户端崩溃，任务栏卡派蒙
- 地图客户端所有地图消失，变成灰蓝底暗角

- 如果遇到以上情况，请检查「空荧酒馆」的安装目录是否生成dmp格式的文件。如果有，则证明自动追踪发生了崩溃现象。
- 遇到崩溃，可以先尝试清理定位缓存，如果无效，可以升级或者重装显卡驱动
- 如果依旧不行，请添加反馈QQ群，并把dmp文件发送给@小狸卡 分析崩溃原因

  如果有其他问题请提交反馈。

  开发反馈 QQ 群：228382171

## 更新日志

以下更新日志供参考，用于排查bug使用

【7.10.2】

1\. 修正了地下的坐标映射，现在地下坐标会更准确一些  
2\. 如果没有获取到坐标，将不会在枫丹左上角显示箭头  
3\. 降低了在地下区域，箭头瞬移到地图外的概率
4. 修复了歌剧院坐标漂移
5. 修复须弥城无法追踪

#### 7.10.0

1. 适配枫丹2
2. 适配地下地图，暂时不支持检测层级
3. 调整坐标系，稍微提高了精度
4. 修复望舒客栈无法追踪

#### 7.9.36

继续修复DirectX截图崩溃问题

#### 7.9.35

修复DirectX截图崩溃问题

#### 7.9.33

支持枫丹的水下区域追踪

#### 7.9.32

1. 支持枫丹已解锁地区追踪
2. 优化主城内的识别

#### GIv38海岛分支

1.适配3.8活动地图  
2.大幅减小了包体体积（需要测试）  
3.修复了自动追踪缓存无法正常更新的问题

#### 7.9.5

修复传送后箭头漂移

#### 7.9.1

1. 改进视角识别算法
2. 提高识别稳定性
3. 修复若干DirectX的报错

#### 7.8.55

优化定位缓存文件的大小
